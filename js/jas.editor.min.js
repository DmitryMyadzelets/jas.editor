!function(){function b(a,c){if(null===a||"object"!=typeof a)return a;var d=a.constructor();for(var e in a)a.hasOwnProperty(e)&&(d[e]=c?b(a[e],!0):a[e]);return d}function c(a){for(var b in a)if(a.hasOwnProperty(b))switch(typeof a[b]){case"number":a[b]|=0;break;case"object":c(a[b])}}function j(a){return a&&a.r?a.r:g}function k(a){return a&&a.r?a.r:g-3}function m(a){var b=[0,0],c=[0,0],d=[0,0],e=function(){return[b[0],b[1]]};return e.start=function(){d[0]=d3.event.pageX,d[1]=d3.event.pageY},e.mouse=function(){return d3.mouse(a[0][0])},e.to_mouse=function(){c[0]=d3.event.pageX-d[0],c[1]=d3.event.pageY-d[1],d[0]=d3.event.pageX,d[1]=d3.event.pageY,b[0]+=c[0],b[1]+=c[1],a.attr("transform","translate("+b[0]+","+b[1]+")")},e}function n(){return{nodes:[],edges:[]}}function o(a){return this.target===a.source&&this.source===a.target}function p(a){a.type=a.source===a.target?2:this._graph.edges.filter(o,a).length>0?1:0}function q(){var a="";return a+="     g.nodes circle {         fill: dodgerblue;         stroke: #555;         stroke-width: 0.09em;         fill-opacity: 0.5;         }     ",a+="     path.edge {         fill: none;         stroke: #333;         stroke-width: 0.09em;         }     ",a+="     path.catch {         fill: none;         }    ",a+="     .nodes text, .edges text {         font-size: small;         font-family: Verdana, sans-serif;         pointer-events: none;         text-anchor: middle;         dominant-baseline: central;         }     "}function r(a,b){function j(){"function"==typeof c.plane_handler&&c.plane_handler.apply(this,arguments)}function k(){e.handle(j)}var c=this,d=d3.select(a||"body"),g=500,h=300,i=d.append("svg").attr("width",g).attr("height",h).classed("unselectable",!0).on("contextmenu",function(){d3.event.preventDefault()});this.selection_rectangle=function(){return r.prototype.selection_rectangle.context(i)},this.select=function(){return r.prototype.select.context(c,n)},this.node_handler,this.edge_handler,i.on("mousedown",j).on("mouseover",k).on("mouseup",j).on("mousemove",j).on("dblclick",j).on("dragstart",function(){d3.event.preventDefault()});var l=i.append("svg:defs");l.append("svg:marker").attr("id","marker-arrow").attr("orient","auto").attr("markerWidth",6).attr("markerHeight",6).attr("refX",6).attr("refY",3).append("svg:path").attr("d","M0,0 L6,3 L0,6"),l.append("style").html(q());var n=i.append("g");this.transform=function(){c.node.attr("transform",f.get_node_transformation),c.edge.each(c.transform_edge)};var o=d3.layout.force().charge(-800).linkDistance(150).chargeDistance(450).size([g,h]).on("tick",this.transform);this.spring=function(){var a=!1,b=function(b){return arguments.length&&(b?a?o.resume():(o.start(),a=!0):(o.stop(),a=!1)),a};return b.on=function(){a&&o.resume()},b.off=function(){a&&o.stop()},b}(),this.node=n.append("g").attr("class","nodes").selectAll("g"),this.edge=n.append("g").attr("class","edges").selectAll("g"),this.pan=m(n),this.svg=i,this.container=d,this.force=o,this.graph(b)}function s(){function a(a,b){a instanceof Array?a.forEach(b):b(a)}function c(a){return void 0===a.uid&&(a.uid=b()),a.uid}function d(a,b){return b instanceof Array?a.filter(function(a){return b.indexOf(a)>=0}):a.filter(function(a){return a===b})}function e(){this.node=this.node.data(this.graph().nodes,c),this.node.enter().call(f.add_node,this.node_handler),this.node.exit().remove()}function g(){this.edge=this.edge.data(this.graph().edges,c),this.edge.enter().call(f.add_edge,this.edge_handler),this.edge.exit().remove()}function h(a){var b=!1;return a.forEach(function(a,c){void 0===a.x&&(a.x=c,b=!0),void 0===a.y&&(a.y=c,b=!0)}),b}function j(a,b){a.forEach(function(a){delete a[b]})}var b=function(){var a=0;return function(){return a++}}();this.graph=function(a){if(arguments.length>0){this._graph=null,this._graph=a||n(),j(this._graph.nodes,"uid"),j(this._graph.edges,"uid");var b=this;this._graph.edges.forEach(function(a){"number"==typeof a.source&&(a.source=b._graph.nodes[a.source]),"number"==typeof a.target&&(a.target=b._graph.nodes[a.target])}),h(this._graph.nodes)&&this.spring(!0),this.update()}return this._graph},this.size=function(a,b){arguments.length&&(this.svg.attr("width",a).attr("height",b),this.force.size([a,b]))},this.update=function(){var a=this.spring();a&&this.spring(!1),e.call(this),g.call(this),this.force.nodes(this._graph.nodes).links(this._graph.edges),a&&this.spring(!0);var b=this;this.edge.each(function(){p.apply(b,arguments)}),this.transform()},this.node_text=function(a,b){d(this.node,a).select("text").text(b)},this.mark_node=function(a){var b=d(this.node,a);b.call(f.mark_node)},this.edge_text=function(a,b){d(this.edge,a).select("text").text(b)},this.edge_by_data=function(a){return d(this.edge,a)},this.select_node=function(b,c){var e=this;c=void 0===c?!0:!!c,a(b,function(a){d(e.node,a).select("circle").classed("selected",c)})},this.select_edge=function(b,c){var e=this;c=void 0===c?!0:!!c,a(b,function(a){d(e.edge,a).select("path.edge").classed("selected",c)})},this.selected_nodes=function(){var a=[],b=this.node.select(".selected");return b.each(function(b){a.push(b)}),a},this.selected_edges=function(){var a=[],b=this.edge.select(".selected");return b.each(function(b){a.push(b)}),a},this.unselect_all=function(){this.svg.selectAll(".selected").classed("selected",!1)},this.initial=function(a){this.node.selectAll("path.edge").remove(),f.initial(d(this.node,a))},this.transform_edge=function(a){var b=f.get_edge_transformation(a),c=d3.select(this);c.selectAll("path").attr("d",b),c.select("text").attr("x",a.tx).attr("y",a.ty)}}function v(){function a(){var a=this.on.update;"function"==typeof a&&a()}function b(a){for(var b=a.length;b--;)a[b]instanceof Array&&(a[b]=a[b].slice(0))}this.start=function(){return this.index<this.stack.length&&(this.stack.length=this.index),this.macro=[],this.stack.push(this.macro),this.index=this.stack.length,this},this.undo=function(){if(this.index>0){for(var b=this.stack[--this.index],c=b.length;c-->0;)b[c].undo();a.call(this)}},this.redo=function(){if(this.index<this.stack.length){var c,b=this.stack[this.index++],d=b.length;for(c=0;d>c;c++)b[c].redo();a.call(this)}},this.new=function(c,d){if(this[c]&&console)return console.error("Command",c,"already exists"),void 0;var e=this;c&&"function"==typeof d&&(this[c]=function(){var c=new t;return b(arguments),d.apply(c,arguments),e.macro.push(c),c.redo(),a.call(this),e})}}function y(a){function d(){a.view.update()}a.node=Object.create(a.node),a.edge=Object.create(a.edge);var b=a.node.__proto__,c=a.edge.__proto__;return a.node.add=function(){var c=b.add.apply(this,arguments);return d(),c},a.node.remove=function(){var c=b.remove.apply(this,arguments);return d(),c},a.node.text=function(c,d){var e=b.text.apply(this,arguments);return a.view.node_text(c,d),e},a.node.shift=function(){var c=b.shift.apply(this,arguments);return a.view.transform(),c},a.node.move=function(){var c=b.move.apply(this,arguments);return a.view.transform(),c},a.node.mark=function(c){var d=b.mark.apply(this,arguments);return a.view.mark_node(c),d},a.node.unmark=function(c){var d=b.unmark.apply(this,arguments);return a.view.mark_node(c),d},a.node.initial=function(c){b.initial(c),a.view.initial(c)},a.edge.add=function(){var a=c.add.apply(this,arguments);return d(),a},a.edge.remove=function(){var a=c.remove.apply(this,arguments);return d(),a},a.edge.text=function(b,d){var e=c.text.apply(this,arguments);return a.view.edge_text(b,d),e},a.edge.move=function(a,b,c){a.source=b,a.target=c,d()},a}var a={version:"1.0.0"},d={length:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},normalize:function(a,b){var c=this.length(a);return c=1/c,b[0]=a[0]*c,b[1]=a[1]*c,b},orthogonal:function(a,b){return b[0]=a[1],b[1]=-a[0],b},scale:function(a,b,c){return c[0]=a[0]*b,c[1]=a[1]*b,c},add:function(a,b,c){return c[0]=a[0]+b[0],c[1]=a[1]+b[1],c},subtract:function(a,b,c){return c[0]=a[0]-b[0],c[1]=a[1]-b[1],c},copy:function(a,b){return b[0]=a[0],b[1]=a[1],b}},e=function(){var a;return{handle:function(b){a=b},handler:function(){a&&"function"==typeof a&&a.apply(this,arguments)}}}();d3.select(window).on("keydown",e.handler).on("keyup",e.handler);var f={},g=16,h=1.6*g;f.make_edge=function(){var a=[0,0],b=[0,0],c=g,e=function(){var a=Math.PI/3,b=Math.PI/12;return{DX1:c*Math.cos(a),DY1:c*Math.sin(a),DX2:4*c*Math.cos(a),DY2:4*c*Math.sin(a),DX3:4*c*Math.cos(b),DY3:4*c*Math.sin(b),DX4:c*Math.cos(b),DY4:c*Math.sin(b),NX:Math.cos(a-Math.PI/24),NY:Math.sin(a-Math.PI/24)}}();return{r1:0,r2:0,stright:function(c,e){d.subtract(e,c,a),d.normalize(a,b),d.scale(b,this.r1,a),d.add(c,a,c),d.scale(b,this.r2,a),d.subtract(e,a,e)},drag:function(c,e,f){d.subtract(e,c,a),d.normalize(a,b),d.scale(b,this.r2,a),d.add(c,a,c),f&&d.subtract(e,a,e)},curve:function(c,e,f){d.subtract(e,c,a),d.normalize(a,b),f[0]=.5*(c[0]+e[0])+2*b[1]*this.r1,f[1]=.5*(c[1]+e[1])-2*b[0]*this.r2,d.copy(f,a),this.stright(c,a),d.copy(f,a),this.stright(e,a)},loop:function(b,c,f,g){d.copy(b,a),b[0]=a[0]+e.DX1,b[1]=a[1]-e.DY1,f[0]=a[0]+e.DX2,f[1]=a[1]-e.DY2,g[0]=a[0]+e.DX3,g[1]=a[1]-e.DY3,c[0]=a[0]+e.DX4,c[1]=a[1]-e.DY4}}}(),f.get_edge_transformation=function(){var a=[0,0],b=[0,0],c=[0,0],d=[0,0];return function(e){switch(a[0]=e.source.x,a[1]=e.source.y,b[0]=e.target.x,b[1]=e.target.y,f.make_edge.r1=void 0!==e.source.r?e.source.r:16,f.make_edge.r2=void 0!==e.target.r?e.target.r:16,e.tx=e.source.x+e.target.x>>1,e.ty=e.source.y+e.target.y>>1,e.type){case 1:f.make_edge.curve(a,b,c),e.tx=c[0]+b[0]>>1,e.ty=c[1]+b[1]>>1;break;case 2:f.make_edge.loop(a,b,c,d),e.tx=c[0]+d[0]>>1,e.ty=c[1]+d[1]>>1;break;default:f.make_edge.stright(a,b)}switch(e.x1=a[0],e.y1=a[1],e.x2=b[0],e.y2=b[1],e.type){case 1:return"M"+a[0]+","+a[1]+"Q"+c[0]+","+c[1]+","+b[0]+","+b[1];case 2:return"M"+a[0]+","+a[1]+"C"+c[0]+","+c[1]+","+d[0]+","+d[1]+","+b[0]+","+b[1];default:return"M"+a[0]+","+a[1]+"L"+b[0]+","+b[1]}}}(),f.get_node_transformation=function(a){return a&&void 0!==a.x&&void 0!==a.y?"translate("+a.x+","+a.y+")":""},f.mark_node=function(a){a.filter(function(a){return!!a.marked&&d3.select(this).select("circle.marked").empty()}).append("circle").attr("r",k).classed("marked",!0),a.filter(function(a){return!a.marked}).selectAll("circle.marked").remove()},f.initial=function(a,b){arguments.length<2||b?a.append("path").attr("class","edge").attr("marker-end","url(#marker-arrow)").attr("d",function(){return"M"+(-g-h)+",0L"+-g+",0"}):a.select("path.edge").remove()},f.add_node=function(a,b){var c=a.append("g").attr("transform",f.get_node_transformation).on("mousedown",b).on("mouseup",b).on("mouseover",b).on("mouseout",b).on("dblclick",b);c.append("circle").attr("r",j),c.call(f.mark_node),c.append("text").attr("alignment-baseline","center").text(function(a){return a.text||""}),f.initial(c.filter(function(a){return!!a.initial}))},f.add_edge=function(a,b){var c=a.append("g").on("mousedown",b).on("mouseup",b).on("mouseover",b).on("mouseout",b).on("dblclick",b);return c.append("path").attr("class","edge").attr("marker-end","url(#marker-arrow)"),c.append("path").attr("class","catch"),c.append("text").attr("alignment-baseline","center").text(function(a){return a.text||""}),c};var l=function(){var a,b,c,d,e,f,g,h,i;return i=null,h=null,g=null,f=!1,b=window.attachEvent?function(a,b,c){return a.attachEvent("on"+b,c),null}:function(a,b,c){return a.addEventListener(b,c,!1),null},e=function(){return i.style.height="auto",i.style.height=i.scrollHeight+"px",null},a=function(){return window.setTimeout(e,0),null},c=function(b){switch(b.keyCode){case 13:i.style.display="none",f=!1,"function"==typeof h&&h(b);break;case 27:i.style.display="none",f=!1,"function"==typeof g&&g(b);break;default:a()}return null},d=function(){return i.style.display="none",f&&(f=!1,"function"==typeof g&&g()),null},{attach:function(e,f,j){return i=document.getElementById(e),b(i,"keydown",c),b(i,"blur",d),b(i,"input",a),h=f,g=j,i.style.font="0.8em Verdana 'Courier New'",null},show:function(){return i.focus(),e(),f=!0,null},text:function(){return i.value}}},l=function(){function d(){"function"==typeof _cancel&&_cancel.apply(this,arguments),b.remove()}function e(){"function"==typeof _enter&&_enter.apply(this,arguments),b.remove()}function f(){switch(d3.event.keyCode){case 13:e.apply(this,arguments);break;case 27:d.apply(this,arguments);break;default:d3.event.stopPropagation(),h()}return null}function g(){b.each(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})}function h(){window.setTimeout(g,0)}var a="c88d9c30-5871-11e4-8ed6-0800200c9a66",b=null,c=null;return _enter=null,_cancel=null,function(e,i,j,k,l,m){b&&b.remove(),c=e,j=j||0,k=k||0,_enter=l,_cancel=m;var n=Number(getComputedStyle(document.body,null).fontSize.match(/(\d*(\.\d*)?)px/)[1]);isNaN(n)||(n/=2,k-=n),b=c.append("textarea").attr("id",a).attr("rows",1).style("position","absolute").style("height","1em").style("left",j+"px").style("top",k+"px").attr("placeholder","Type here..."),b.on("blur",d).on("change",g).on("keydown",f).on("cut",h).on("drop",h).on("paste",h),b.each(function(){this.value=i,this.focus(),this.select()}),g()}}();window.textarea=l,s.call(r.prototype),r.prototype.selection_rectangle=function(){var a,b,c,d,e,f,h,i,g={},j=function(){var e=[a,b,c,d];return a>c&&(e[0]=c,e[2]=a),b>d&&(e[1]=d,e[3]=b),e};return j.show=function(c){a=c[0],b=c[1],h=i.append("rect").attr({x:a,y:b,"class":"selection"})},j.update=function(i){c=i[0],d=i[1],e=c-a,f=d-b,g.x=a,g.y=b,0>e&&(e=-e,g.x=c),0>f&&(f=-f,g.y=d),g.width=e,g.height=f,h.attr(g)},j.hide=function(){h.remove()},j.context=function(a){return i=a,this},j}(),r.prototype.select=function(){function c(a,b,c){return a>c[0]&&a<c[2]&&b>c[1]&&b<c[3]}var d,e;return{context:function(a,b){return d=a,e=b,this},by_rectangle:function(a){var b=d.pan();a[0]-=b[0],a[2]-=b[0],a[1]-=b[1],a[3]-=b[1],d.node.each(function(b){c(b.x,b.y,a)&&d.select_node(b)}),d.edge.each(function(b){c(b.x1,b.y1,a)&&c(b.x2,b.y2,a)&&d.select_edge(b)})}}}();var t=function(a,b){a&&(this.redo=a),b&&(this.undo=b)};t.prototype.redo=function(){},t.prototype.undo=function(){};var u={stack:[],macro:[],index:0,on:{}};v.call(u),u.new("add_node",function(a,b){this.redo=function(){a.node.add(b)},this.undo=function(){a.node.remove(b)}}),u.new("del_node",function(a,b){this.redo=function(){a.node.remove(b)},this.undo=function(){a.node.add(b)}}),u.new("add_edge",function(a,b){this.redo=function(){a.edge.add(b)},this.undo=function(){a.edge.remove(b)}}),u.new("del_edge",function(a,b){this.redo=function(){a.edge.remove(b)},this.undo=function(){a.edge.add(b)}}),u.new("node_text",function(a,b,c){var d=b.text;this.redo=function(){a.node.text(b,c)},this.undo=function(){a.node.text(b,d)}}),u.new("edge_text",function(a,b,c){var d=b.text;this.redo=function(){a.edge.text(b,c)},this.undo=function(){a.edge.text(b,d)}}),u.new("move_node",function(a,b,c,d){this.redo=function(){a.node.move(b,d)},this.undo=function(){a.node.move(b,c)}}),u.new("mark_node",function(a,b){this.redo=function(){a.node.mark(b)},this.undo=function(){a.node.unmark(b)}}),u.new("unmark_node",function(a,b){this.redo=function(){a.node.unmark(b)},this.undo=function(){a.node.mark(b)}}),u.new("initial",function(a,b,c){this.redo=function(){a.node.initial(c)},this.undo=function(){a.node.initial(b)}}),u.new("move_edge",function(a,b,c,d){this.redo=function(){a.edge.move(b,d[0],d[1])},this.undo=function(){a.edge.move(b,c[0],c[1])}}),u.new("spring",function(a,b){var c=[],d=b.object().nodes;d.forEach(function(a){c.push(a.x,a.y)}),this.redo=function(){a.spring(!0)},this.undo=function(){a.spring(!1),b.node.move(d,c)}}),r.prototype.controller=function(){var a,b,c,e,g,h,i,j,k,m,n,o,s,t,v,q=[],r=[],w={init:function(f){switch(c){case"plane":switch(e){case"mousemove":break;case"dblclick":d3.event.ctrlKey||a.unselect_all(),g=a.pan.mouse();var h={x:g[0],y:g[1]};u.start().add_node(b,h),a.select_node(h);break;case"mousedown":if(d3.event.shiftKey){a.pan.start(),s=w.move_graph;break}g=d3.mouse(this),s=w.wait_for_selection;break;case"keydown":switch(d3.event.keyCode){case 46:j=a.selected_nodes();var k=a.model.edge.adjacent(j);k=k.concat(a.selected_edges().filter(function(a){return k.indexOf(a)<0})),u.start().del_node(b,j).del_edge(b,k),s=w.wait_for_keyup;break;case 70:a.spring()?a.spring(!1):u.start().spring(a,b);break;case 73:u.start().initial(b,a._graph.nodes.filter(function(a){return!!a.initial}),a.selected_nodes());break;case 77:j=a.selected_nodes(),d3.event.ctrlKey?u.start().unmark_node(b,j):u.start().mark_node(b,j);break;case 89:d3.event.ctrlKey&&(u.redo(),a.spring.on()),s=w.wait_for_keyup;break;case 90:d3.event.ctrlKey&&(u.undo(),a.spring.on()),s=w.wait_for_keyup}}break;case"node":switch(e){case"mousedown":i=f,g=a.pan.mouse(),j=a.selected_nodes(),d3.event.shiftKey?(a.select_node(f),j=a.selected_nodes(),q.length=0,j.forEach(function(a){a.fixed=!0,q.push(a.x,a.y)}),s=w.drag_node):(d3.event.ctrlKey?a.select_node(f,j.indexOf(f)<0):(a.unselect_all(),a.select_node(f)),s=w.wait_for_new_edge);break;case"dblclick":d3.event.stopPropagation(),v=d3.select(this).select("text"),v.text("");var m=function(){var b=a;return function(){b.controller().context("text").event.apply(this,arguments)}}(),n=f.text||"",p=a.pan();l(a.container,n,f.x+p[0],f.y+p[1],m,m),s=w.edit_node_text}break;case"edge":switch(e){case"mousedown":k=a.selected_edges(),d3.event.shiftKey?(a.select_edge(f),k=a.selected_edges()):(d3.event.ctrlKey?a.select_edge(f,k.indexOf(f)<0):(a.unselect_all(),a.select_edge(f)),s=w.wait_for_new_edge);var r=[],t=[];g=a.pan.mouse(),d.subtract(g,[f.x1,f.y1],t),d.subtract(g,[f.x2,f.y2],r),o=d.length(r)<d.length(t),s=w.wait_for_edge_dragging;break;case"dblclick":d3.event.stopPropagation(),i=f,v=d3.select(this).select("text"),v.text("");var m=function(){var b=a;return function(){b.controller().context("text").event.apply(this,arguments)}}(),n=f.text||"",p=a.pan(),x=f.tx+p[0],y=f.ty+p[1];l(a.container,n,x,y,m,m),a.spring.off(),s=w.edit_edge_text}}},wait_for_new_edge:function(){switch(e){case"mouseup":s=w.init;break;case"mouseout":g=a.pan.mouse(),n={x:g[0],y:g[1],r:1},m={source:i,target:n},u.start().add_edge(b,m),o=!0,k=a.edge_by_data(m).selectAll("path"),a.spring.off(),s=w.drag_edge}},wait_for_edge_dragging:function(d){switch(c){case"edge":switch(e){case"mouseup":s=w.init;break;case"mouseout":g=a.pan.mouse(),n={x:g[0],y:g[1],r:1},m=d;var f=[m.source,m.target];o?d.target=n:d.source=n,u.start().move_edge(b,m,f,[m.source,m.target]),a.spring.off(),p.call(a,m),k=a.edge_by_data(m).selectAll("path"),a.unselect_all(),a.select_edge(m),s=w.drag_edge;break;default:s=w.init}}},drag_edge:function(d){switch(e){case"mousemove":g=a.pan.mouse(),n.x=g[0],n.y=g[1],k.attr("d",f.get_edge_transformation(m));break;case"mouseup":delete n.r,u.add_node(b,n),a.unselect_all(),a.select_edge(m),a.select_node(o?m.target:m.source),a.spring.on(),s=w.init;break;case"mouseover":switch(c){case"node":var h=[m.source,m.target];o?m.target=d:m.source=d,u.move_edge(b,m,h,[m.source,m.target]),p.call(a,m),k.attr("d",f.get_edge_transformation(m)),s=w.drop_edge_or_exit}}},drop_edge_or_exit:function(){switch(c){case"node":switch(e){case"mouseup":var d=a.graph().edges.filter(function(a){return a.source===m.source&&a.target===m.target});d.length>1&&u.del_edge(b,m),d3.event.ctrlKey||a.unselect_all(),d.length<=1&&a.select_edge(m),a.update(),s=w.init;break;case"mouseout":var f=[m.source,m.target];o?m.target=n:m.source=n,u.move_edge(b,m,f,[m.source,m.target]),p.call(a,m),s=w.drag_edge}}},drag_node:function(){switch(e){case"mousemove":var c=g;g=a.pan.mouse(),c[0]=g[0]-c[0],c[1]=g[1]-c[1],a.model.node.shift(j,c),a.spring.on(),c[0]=g[0],c[1]=g[1];break;case"mouseup":r.length=0,j.forEach(function(a){delete a.fixed,r.push(a.x,a.y)}),a.spring()?a.spring.on():u.start().move_node(b,j,q,r),s=w.init}},wait_for_selection:function(){switch(e){case"mousemove":d3.event.ctrlKey||a.unselect_all(),h=a.selection_rectangle(),h.show(g),g=d3.mouse(this),s=w.selection;break;case"mouseup":d3.event.ctrlKey||a.unselect_all(),s=w.init;break;default:s=w.init}},selection:function(){switch(e){case"mousemove":h.update(d3.mouse(this));break;case"mouseup":a.select().by_rectangle(h()),h.hide(),s=w.init}},move_graph:function(){switch(e){case"mousemove":d3.event.shiftKey||(s=w.init),a.pan.to_mouse();break;case"mouseup":s=w.init}},wait_for_keyup:function(){"keyup"===e&&(s=w.init)},edit_node_text:function(){if("text"===c){switch(v.text(function(a){return a.text}),e){case"keydown":13===d3.event.keyCode&&u.start().node_text(b,i,this.value)}a.spring.on(),s=w.init}},edit_edge_text:function(){if("text"===c){switch(v.text(function(a){return a.text}),e){case"keydown":13===d3.event.keyCode&&u.start().edge_text(b,i,this.value)}a.spring.on(),s=w.init}}};s=w.init;var x;for(x in w)w.hasOwnProperty(x)&&(w[x]._name=x);var y=null,z={event:function(){if(a){if(y!==a){if(s!==w.init)return;y=a}c=c||d3.event.target.nodeName,e=d3.event.type,t=s,s.apply(this,arguments),a=null,c=null,t!==s&&console.log("transition:",t._name+" -> "+s._name)}},context:function(a){return c=a,this},control_view:function(){var b=a;return a.node_handler=function(){b.controller().context("node").event.apply(this,arguments)},a.edge_handler=function(){b.controller().context("edge").event.apply(this,arguments)},a.plane_handler=function(){b.controller().context("plane").event.apply(this,arguments)},z}};return function(){return a=this,b=a.model,y||(y=a),z}}();var x=function(){function a(a,b){a instanceof Array?a.forEach(b):b(a)}function d(){function d(a){a.x+=b[0],a.y+=b[1],a.px=a.x,a.py=a.y}function e(a){a.marked=!0}function f(a){delete a.marked}function g(a){a.initial=!0}function h(a){delete a.initial}var b=[0,0];this.shift=function(c,e){b[0]=e[0],b[1]=e[1],a(c,d)},this.move=function(b,c){if(c instanceof Array){var d=0;a(b,function(a){a.x=c[d++],a.y=c[d++],a.px=a.x,a.py=a.y})}},this.mark=function(b){a(b,e)},this.unmark=function(b){a(b,f)},this.initial=function(b){a(this.data,h),a(b,g)}}function e(){function a(a,b,c){var d;return b instanceof Array?(d=[],b.forEach(function(b){for(var e=a.filter(function(a){return c(a,b)});e.length;)d.push(e.pop())})):d=a.filter(function(a){return c(a,b)}),d}this.adjacent=function(b){return a(this.data,b,function(a,b){return a.source===b||a.target===b})},this.incoming=function(b){return a(this.data,b,function(a,b){return a.target===b})},this.outgoing=function(b){return a(this.data,b,function(a,b){return a.source===b})}}function f(){function c(a){b.push(a)}function d(a){var c=b.indexOf(a);c>=0&&b.splice(c,1)}var b;this.add=function(d){return b=this.data,a(d,c),this},this.remove=function(c){return b=this.data,a(c,d),this},this.text=function(a,b){return a.text=b,this}}var g=Object.create({});f.call(g);var h=Object.create(g);d.call(h);var i=Object.create(g);return e.call(i),{graph:function(a){var d={node:Object.create(h),edge:Object.create(i)};return d.node.data=[],d.edge.data=[],a&&a.nodes instanceof Array&&(d.node.data=a.nodes,a.edges instanceof Array&&(d.edge.data=a.edges)),d.object=function(){return{nodes:this.node.data,edges:this.edge.data}},d.storable=function(){var a=this.object();return a.edges=a.edges.map(function(c){var d=b(c);return d.source=a.nodes.indexOf(c.source),d.target=a.nodes.indexOf(c.target),d}),a=b(a,!0),c(a),a},"function"==typeof y&&(d=y(d)),d}}}();a.instance=function(a){var b={view:new r(a),set_graph:function(a){this.graph=x.graph(a),this.view.model=this.graph,this.graph.view=this.view,this.view.graph(this.graph.object())}};return b.view.controller().control_view(),b.set_graph(),b},a.commands=u,this.jA=this.jA||{},this.jA.editor=a,this.jA.model=x}(window);